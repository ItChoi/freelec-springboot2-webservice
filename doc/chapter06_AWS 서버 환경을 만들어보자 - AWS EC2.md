## AWS 서버 환경을 만들어보자 - AWS EC2
- 24시간 작동 서버 3가지 선택지
  - 집 PC를 24시간 구동 (서버 환경 구축)
  - 호스팅 서비스 (Cafe 24, 코리아 호스팅) 이용
  - 클라우드 서비스 (AWS, AZURE, GCP 등) 이용
- 비용
  - 집 PC, 호스팅이 저렴
  - 특정 시간대에 유동적으로 트래픽이 몰릴 시 클라우드가 효율
- 클라우드
  - 인터넷(클라우드)를 통해 서버, 스토리지(파일 저장소), DB, 네트워크, 소프트 웨어, 모니터링 등 컴퓨팅 서비스를 제공하는 것
    - AWS EC2를 통해 서버 장비를 대여하지만, 실제로는 로그 관리, 모니터링, 하드웨어 교체, 네트워크 관리 등 기본적으로 지원하고 있다.
    - 즉 개발자가 직접 해야 할 일을 AWS가 전부 지원해준다.
- 클라우드의 몇 가지 형태
  - Infrastructure as a Service (IaaS, 아이아스, 이에스)
    - 기존 물리 장비를 미들웨어와 함께 묶어둔 추상화 서비스
    - 가상 머신, 스토리지, 네트워크, 운영체제 등 IT 인프라를 대여해 주는 서비스
    . EC2, S3 등 ...
  - Platform as a Service (Paas, 파스)
    - IaaS에서 한 번 더 추상화한 서비스
    - 더 많은 기능이 자동화되어 있다.
    - Beanstalk(빈스톡), Heroku(헤로쿠)
  - Software as a Service (SaaS, 사스)
    - 소프트 웨어 서비스
    - 구글 드라이브, 드랍박스, 와탭 등
    
### AWS 회원 가입
- 완료

### EC2 인스턴스 생성하기
- EC2는 AWS에서 제공하는 성능, 용량 등을 유동적으로 사용 가능한 서버
- 보통 AWS에서 리눅스 서버 혹은 윈도우 서버를 사용한다 하면 EC2를 야기 하는 것

- AWS 무료 제공 프리티어 플랜에서는 EC2 사용에 다음과 같은 제한이 있다.
  - 사양이 t2.micro만 가능
    - vCPU(가상 CPU) 1 Core, 메모리 1GB 사양
    - 보통 vCPU는 물리 CPU 사양의 절반 정도 성능을 가진다.
    - 월 750시간의 제한이 있다. 초과 시 비용 부담
      - 24시간 * 31일 = 744시간
      - 즉, 1대의 t2.micro만 사용하면 24시간 사용 가능
  - EC2 만들기 전 본인 리전 확인
    - AWS 서비스 구동 지역, AWS는 도시 별로 클라우드 센터를 지어 해당 센터에서 구축된 가상머신을 사용 가능 이걸 리전이라 한다.
    - 서울 리전이 생기기 전에는 한국에서 가까운 도쿄 리전을 사용했지만, 이제는 서울 리전을 사용하면 된다.
- EC2 검색 후 클릭
  - 인스턴스 -> 인스턴스 시작 클릭 (인스턴스란 EC2서비스에 생성된 가상머신을 야기한다.)
  - 생성 첫 단계는, AMI(Amazon Machine Image)를 선택하는 것이다.
    - AMI: EC2 인스턴스를 시작하는 데 필요한 정보를 이미지로 만들어 둔 것, 인스턴스라는 가상 머신에 운영체제 등을 설치할 수 있게 구워 놓은 이미지로 생각!
    - Amazon Linux AMI 선택!
      - 이 버전은 센토스 6 버전을 그대로 사용 할 수 있다. 그렇다면 왜 센토스 AMI를 사용하지 않고, 아마존 리눅스 AMI를 사용할까?
        - 아마존 리눅스 AMI 사용 이유        
          - 아마존이 개발하기에 지원받기 쉽다.
          - 레드햇 베이스... 많이 다뤄본 사람일수록 문제없이 사용 가능
          - AWS의 각종 서비스와 상성이 좋다.
          - 아마존 독자적 개발 리포지터리를 사용하고 있어 yum이 매우 빠르다.
  - 두 번 째 단계는 인스턴스 유형을 선택하는 단계로, 프리티어로 표기된 t2.micro 선택
    - t2는 요금 타입을 야기하며, micro는 사양이다
    - t 시리즈는 범용 시리즈라 불린다. 이들은 다른 서비스와 달리 크레딧이란 일종의 CPU를 사용할 수 있는 포인트 개념이 있다. 인스턴스 크기에 따라 CPU 크레딧을 계속 받게 되며 사용하지 않을땐 축적, 사용 시 크레딧 사용! 크레딧 모두 사용 시 EC2를 사용 할 수 없다. 따라서 트래픽 높은 서비스는 T 시리즈 말고 다른 시리즈 사용
    - 필요 정보 선택 후 다음:인스턴스 세부 정보 구성 클릭
  - 세 번 째 단계는 세부 정보 구성 단계이다. 기업 사용 시 화면상에 표기된 VPC, 서브넷 등 세세하게 두라주민, 혼자 1대의 서버만 사용할 경우 별다른 설정하지 않는다.
    - 다음: 스토리지 추가 클릭
  - 네 번 째 단계는 스토리지 선택 단계로, 흔히 하드디스크라고 부르는 서버의 디스크(SSD 포함)를 야기하며 서버의 용량을 정하는 단계
    - 여기서는 기본 값 8GB로 되어 있으나 30GB까지 프리티어로 가능하다. 그 이상 사이즈는 비용이 청구된다. 따라서 30GB로 바꾸자.
    - 다음: 태그 추가 클릭
  - 다섯 번 째 단계는 태그 추가 단계로, 웹 콘솔에서 표기될 태그인 Name 태그를 등록한다. 
    - 태그는 해당 인스턴스를 표현하는 여러 이름으로 사용될 수 있다. EC2의 이름을 붙인다고 생각하고 명명
    - 여러 인스턴스 사용 시 이를 태그 별로 구분하면 검색이나 그룹 짓기 편하다.
    - 본인 서비스의 인스턴스를 나타낼 수 있는 값으로 이름을 등록
    - 다음: 보안 그룹 구성 클릭
  - 여섯 번 째 단계는 보안 그룹 구성 단계로, 보안 그룹은 방화벽을 말한다.
    - 서버로 80 포트 외에는 허용하지 않는다는 역할을 하는 방화벽이 AWS에서는 보안 그룹으로 사용된다.
    - 기존 생성 보안 그룹이 없으므로 보안 그룹 이름엔 유의미한 이름으로 변경한다.
      - SSH -> 내 IP, 사용자 지정 TCP -> 8080 사용자 지정, HTTPS -> 사용자 지정 
    - 보안 그룹 부분은 굉장히 중요하다. 유형 항목에 SSH이면서 포트 22인 경우 AWS EC2에 터미널로 접속할 때를 말한다. pem 키가 없으면 접속이 안되니 전체 오픈하는 경우 종종 있다. 그러나 이후 실수로 pem 키를 노출 시 가상화폐 채굴 대상이 된다.
      - 따라서 보안은 언제나 높을 수록 좋으니 pem 키 관리와 지정된 IP에서만 ssh 접속이 가능하도록 하는 것이 안전하다.
      - 따라서 사용 컴퓨터 IP로 지정하고, 다른 장소에서 사용 시 해당 장소 IP를 다시 SSH 규칙에 추가하는 것이 안전
    - 검토 및 시작 클릭
  - 마지막 단계는 검토 단계로, 인스턴스로 접근하기 위해서 pem 키(비밀키)가 필요하다.
    - 인스턴스 마지막 단계에서 할당할 pem키 선택이 필요
    - 인스턴스는 지정된 pem 키(비밀키)와 매칭되는 공개키를 가지고 있어, 해당 pem 키 외에는 접근을 허용하지 않는다.
    - pem 키는 일종의 마스터 키 이기 때문에 절대로 유출되면 안된다.
    - pem 키는 이후 EC2 서버로 접속할 때 필수 파일이니 잘 관리할 수 있는 디렉토리로 저장!!
    - 시작하기 클릭 후 pem 키 있으면 선택, 없으면 신규 생성
    - 키 페어 다운로드 클릭 후 인스턴스 시작 버튼 클릭
  - 인스턴스 생성 시작 페이지로 이동 후 인서튼서 id 클릭하여 EC2 목록 이동

- 인스턴스도 하나의 서버이기 때문에 IP가 존재한다.
  - 인스턴스 생성 시 항상 새 IP 할당한다.
  - 같은 인스턴스를 중지하고 다시 시작 시 새 IP할당한다.
    - 요금 아끼기 위해 인스턴스 중시 후 다시 시작 시 IP 변경된다. 따라서 PC에서 접근 때 마다 IP 주소 확인 하는 것은 번거로우므로, 고정 IP를 가지게 할당이 필요하다.
      - EIP 할당 (Elastic IP, 고정 IP: )    
        - 새 주소 할당 클릭하여 할당 후 EC2 주소와 연결 필요
        - 탄력적 IP 페이지에 작업 -> 주소 연결 선택 -> 인스턴스와 프라이빗 IP 주소 선택 후 연결 클릭
        - 인스턴스 목록으로 가 해당 인스턴스에 탄력적 IP가 적용 됐는지 확인
        - **주의점 !!! - 탄력적 IP 생성 후 EC2 서버에 연결하지 않으면 비용 발생!!!! 따라서 생성 후 바로 연결!!!!!**
        
### EC2 서버에 접속하기
- Mac과 윈도우 나눠서 진행함.
  - Mac & Linux는 터미널
  - 윈도우는 putty
- 접속 불가 및 권한 문제로 메시지가 나올 시 참고
  1. HostName 값이 정확히 탄력적 IP로 되어 있는 지 확인
  2. EC2 인스턴스가 running 상태인지 확인
  3. EC2 인스턴스의 보안 그룹 -> 인바운드 규칙에서 현재 본인의 IP가 등록되어 있는 지 확인

- Window
  - 윈도우에서는 Mac과 같이 ssh 접속하기엔 불편한 점이 많아 별도의 클라이언트 설치!
    - putty 사이트 [https://www.putty.org/](https://www.putty.org/) 접속 후 실행 파일 내려 받기.
      - 두 가지 실행 파일 다운로드
        - putty.exe
        - puttygen.exe
    - puttygen.exe 파일 실행
      - putty는 pem 키로 사용이 안되며, pem 키를 ppk 파일로 변환을 해야 한다.
        - puutygen은 이 과정을 진행해 주는 클라이언트!
      - 화면 상단 Conversions -> Import key 선택 후 pem 키 선택 후 Save private key 버튼 클릭하여 ppk 생성
        - 경고 메시지 뜰 시 [예]를 클릭하고 넘어간다.
      - ppk 파일이 저장될 위치와 ppk 이름을 등록
      - ppk 파일 생성 후 putty.exe 파일 실행 후 각 항목 등록
        - Connection -> SSH -> Auth -> Private key file for authentication에서 Browse 클릭 후 ppk 파일 선택
      - Session -> Saved Sessions에 현재 설정들을 저장할 이름 등록 후 Save 후 Load 클릭 시 SSh 접속 알림 등장하면 [예] 클릭